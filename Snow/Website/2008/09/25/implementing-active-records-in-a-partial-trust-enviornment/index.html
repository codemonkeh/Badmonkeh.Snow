
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US"><!--<![endif]-->
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="keywords" content="Christian Froehlich,Christian Fr&#0246;hlich,badmonkeh,software,development,photography,architecture,design patterns,.net,c#,asp.net,sql,html,css" />
    <title>Don't make me think | Ramblings and rants about coding, technology and other stuff…</title>
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="stylesheet" type="text/css" media="all" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/prettify.css" />
    <!--[if lt IE 9]>
    <script src="/js/html5.js" type="text/javascript"></script>
    <![endif]-->
    <meta name="robots" content="noindex,follow">
    <link rel="alternate" type="application/rss+xml" title="Don't make me think » Feed" href="/feed/">
    <link rel="canonical" href="http://www.badmonkeh.com/2008/09/25/implementing-active-records-in-a-partial-trust-enviornment/" />
</head>
<body class="home blog custom-background single-author two-column right-sidebar">
	<div id="page" class="hfeed">
		<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="/" title="Don't make me think" rel="home">Don't make me think</a></span></h1>
				<h2 id="site-description">Ramblings and rants about coding, technology and other stuff…</h2>
			</hgroup>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
				<div class="skip-link"><a class="assistive-text" href="#content" title="Skip to primary content">Skip to primary content</a></div>
				<div class="skip-link"><a class="assistive-text" href="#secondary" title="Skip to secondary content">Skip to secondary content</a></div>
				<div class="menu">
                    <ul>
                        <li class="current_page_item"><a href="/">Home</a></li>                        
                        <li class="page_item page-item-2"><a href="/category">Categories</a></li>
						<li class="page_item page-item-3"><a href="/tag">Tags</a></li>
                        <li class="page_item page-item-4"><a href="/archive">Archive</a></li>
                        
                        <li class="page_item page-item-6"><a href="/feed.xml">Feed</a></li>
                    </ul>
                </div>
			</nav><!-- #access -->
		</header><!-- #branding -->
        <div id="main">
            <div id="primary" class="site-content">
                <div id="content" role="main">
                  

<article class="post type-post status-publish format-standard hentry">
    <header class="entry-header">
        <h1 class="entry-title">Implementing Active Records in a Partial Trust Environment</h1>

        <div class="entry-meta">
            <span class="sep">Posted on </span>25 Sep 2008
        </div><!-- .entry-meta -->
    </header><!-- .entry-header -->

    <div class="entry-content">
        

        <h1>Implementing Active Records in a Partial Trust Environment</h1>

<p>a) Create a new project for the Model (a.k.a Data Access Layer)</p>

<p>b) Presuming you already have an existing database the next step is to generate classes for all of your strong entities.
   This can be done using the fantastic tool available here: http://www.bryanchen.com/2007/07/18/caragen-tool-the-castle-active-record-autonomous-generator-tool/
   One thing to note about this tool is that is will not generate relationships between entities so you'll have to do that yourself. If you are unsure the on how to do this the manual is a great help.
   Also you might want to update the templates first to fit your coding style, and fix up any areas in the resulting classes afterwards</p>

<p>c) The next step is to create the connection source for your database. It is better practice to do this in an xml file but you can do it in code of you prefer.</p>

<p>First add the following line inside your webconfig, in the configSections:</p>

<pre><code>&lt;section name="activerecord" requirePermission="false" type="Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord"/&gt;
</code></pre>

<p>Then add a new section as below:</p>

<pre><code>&lt;activerecord isWeb="true"&gt;
    &lt;config&gt;
        &lt;add key="connection.driver_class" value="NHibernate.Driver.SqlClientDriver" /&gt;
        &lt;add key="dialect" value="NHibernate.Dialect.MsSql2005Dialect" /&gt;
        &lt;add key="connection.provider" value="NHibernate.Connection.DriverConnectionProvider" /&gt;
        &lt;add key="connection.connection_string_name" value="badmonkeh" /&gt;            
    &lt;/config&gt;
&lt;/activerecord&gt;
</code></pre>

<p>In this case i am referring to a MSSQL 2005 database with a predefined connection string with the name badmonkeh.</p>

<p>d) Then we need a class to initialise your database connection.
   This class basically has to tweak a couple of settings initialise all of the our record types. An elegant solution would be to use reflection for this, but unfortunately my host does not trust me enough for that. Below is an example class.</p>

<p><code>
    public class ActiveRecordsInitialiser
    {
        public static void InitaliseSession()
        {
            IConfigurationSource config = ActiveRecordSectionHandler.Instance;
            ActiveRecordStarter.Initialize(config, GetAllActiveRecordTypes());
            NHibernate.Cfg.Environment.UseReflectionOptimizer = false;
        }<br />
        private static Type[] GetAllActiveRecordTypes()
        {
            List&lt;Type&gt; types = new List&lt;Type&gt;();<br />
            //TODO: Manually add types here 
            return types.ToArray();
        }
    }
</code>    </p>

<p>d) The next step is to ensure that the model is initialised every time the domain is loaded. Open up your global.asax file, or create a new "Global Application Class" if you do not have one.
   In the Appllication_Start event insert the following code:</p>

<pre><code>`YourNameSpace.ActiveRecordsInitialiser.InitaliseSession();`
</code></pre>

<p>Obviously replacing the namespace with your own.</p>

<p>e) To get this to run you will need to add a reference to the following libraries (that are included with active records) to your web.config:</p>

<p><code>Iesi.Collections.dll, log4net.dll, Castle.Components.Validator.dll</code></p>

<p>f) Enable lazy loading in a partial trust environment is the final (optional) step. Personally lazy loading is a huge benefit so i can't do without it. However i will leave this for a post of it's own :)</p>

    </div><!-- .entry-content -->   
    
    <footer class="entry-meta">
        <span class="cat-links">
		<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span>
				<a href="/category/software-development" title="Snow.Models.Category" rel="category tag">Software Development</a>,
        </span>
        <span class="sep"> | </span>
        <span class="tag-links">
            <span class="entry-utility-prep entry-utility-prep-tag-links">Tagged</span> 
					<a href="/tag/.net" title="Snow.Models.Tag" rel="tag">.net</a>,
					<a href="/tag/active-records" title="Snow.Models.Tag" rel="tag">Active Records</a>,
					<a href="/tag/c" title="Snow.Models.Tag" rel="tag">c#</a>,
					<a href="/tag/castle" title="Snow.Models.Tag" rel="tag">Castle</a>,
					<a href="/tag/lazy-loading" title="Snow.Models.Tag" rel="tag">lazy loading</a>,
					<a href="/tag/orm" title="Snow.Models.Tag" rel="tag">orm</a>,
					<a href="/tag/partial-trust" title="Snow.Models.Tag" rel="tag">partial trust</a>,
        </span>

        

		<div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://www.badmonkeh.com/2008/09/25/implementing-active-records-in-a-partial-trust-enviornment/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'badmonkehblog';
    var disqus_url = 'http://www.badmonkeh.com/2008/09/25/implementing-active-records-in-a-partial-trust-enviornment/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer><!-- .entry-meta -->
	
</article>

                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->
			
            <div id="secondary" class="widget-area" role="complementary">
                <aside id="text-2" class="widget widget_text">
                    <h3 class="widget-title">About me</h3>
                    <div class="textwidget">
                        <a href="/about"><img src="/images/profile/me.jpg" border="0"></a>
                        <p>Hi, i'm Christian Froehlich.</p>
                        <p>
                            I'm a passionate .NET Software Developer with over 10 years of experience in building web application and solving complex problems.
                        </p>
                        <p>I'm also interested in photography, 3D printing, beer and coffee. Check me out ;)</p>
                    </div>
                </aside>
                <aside id="text-3" class="widget widget_text">
                    <div class="textwidget">
                        <a href="https://stackoverflow.com/users/73027/codemonkeh">
                            <img src="https://stackoverflow.com/users/flair/73027.png" width="208" height="58" alt="profile for codemonkeh at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for codemonkeh at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
                        </a>
                    </div>
                </aside>
                <aside id="text-4" class="widget widget_text">
                    <div class="textwidget">
                        <a href="/rss.xml" title="RSS 2.0 Feed"><img src="/images/rss-2x.png" alt="Subscribe via RSS" align="middle" height="46" width="46"><span style="padding-left: 5px;">Subscribe via RSS</span></a><br>
                    </div>
                </aside>
                <aside id="categories-2" class="widget widget_categories">
                    <h3 class="widget-title">Categories</h3>
                    <ul>
                            <li class="cat-item"><a href="/category/photography" title="Snow.Models.Category" rel="tag">Photography</a></li>
                            <li class="cat-item"><a href="/category/software-development" title="Snow.Models.Category" rel="tag">Software Development</a></li>
                    </ul>
                </aside>
                <aside id="recent-posts-2" class="widget widget_recent_entries">
                    <h3 class="widget-title">Recent Posts</h3>
                    <ul>
                            <li><a href="/2018/03/14/converting-mpeg-to-h.265/">Converting MPEG to H.265</a></li>
                            <li><a href="/2015/07/07/wix-and-the-tfs-2013-build-server-lets-be-friends/">Wix and the TFS 2013 build server, let's be friends</a></li>
                            <li><a href="/2013/02/12/designdata-makes-your-life-easier/">DesignData makes your life easier</a></li>
                            <li><a href="/2010/09/11/active-records-with-partial-trust-revisited/">Active Records with Partial Trust, Revisited</a></li>
                            <li><a href="/2010/08/14/upgrading-castle-active-recods/">Upgrading Castle Active Records</a></li>
                    </ul>
                </aside>
            </div><!-- #secondary .widget-area -->

        </div>
        <!-- #main -->

		<footer id="colophon" role="contentinfo">
			<div>
			Powered by <a href="https://github.com/codemonkeh/Sandra.Snow" rel="generator">Sandra.Snow</a>. Copyright © 2018 Christian Froehlich. All rights reserved. 
			</div>
		</footer><!-- #colophon -->		
    </div>
	
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/js/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-68156920-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
